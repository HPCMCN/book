# 1. 强制转换

不同的数据类型之间, 是可以进行强制转换的

## 1.1 int

整形, 不可变类型

其他数据类型强制向`int`数据类型转换

| 数据类型 | 转换规则                                                    |
| -------- | ----------------------------------------------------------- |
| `bool`   | False              --> 0<br>True               --> 1        |
| `float`  | 直接舍去小数                                                |
| `str`    | 只支持整形数字转换, 如: <br>`"567"`  --> `567`, 不支持小数. |
|          | 以下类型不支持强制转换`int`类型                             |
|          | `None`/`tuple`/`list`/`dict`/`set`                          |



## 1.2 float

将其他数据类型强制转换为`float`类型

| 转换类型 | 转换规则                                    |
| -------- | ------------------------------------------- |
| `int`    | `5`  --> `5.0`                              |
| `bool`   | `True`  --> `1.0`<br>`False`  -->  0.0      |
| `str`    | 整形数字精确到`0.0`<br>浮点类型按照实际转换 |
|          | 以下数据类型不能进行转换                    |
|          | `None`/`tuple`/`list`/`dict`/`set`          |



## 1.3 str

字符串类型强制转换比较特殊, 是直接调用对象中的`__str__`的魔法方法. 默认情况下就是将其他类型**带符号字符串化**, 实例:

```python
In [1]: str(1)                                                                                                      
Out[1]: '1'

In [2]: str(1.1)                                                                                                    
Out[2]: '1.1'

In [3]: str([1, 2, 3, 4])                                                                                           
Out[3]: '[1, 2, 3, 4]'
```



## 1.4 bool

`bool`类型强制转换也比较特殊,:

* 该不为空即为`True`
* 该类型为空则为`False`

| 转换类型 | 示例                                     |
| -------- | ---------------------------------------- |
| `bool`   | `-1.1`  --> `True`<br>`0.0`  --> `False` |
| `int`    | `0`  --> `False`<br>`-1`  --> `True`     |
| `str`    | `''`  --> `False`<br>`'0'`  --> `True`   |
| `None`   | `False`                                  |
| `list`   | `[]`  --> `False`<br>`[0] ` --> `True`   |
| `set`    | 同上                                     |
| `dict`   | 同上                                     |
| `tuple`  | 同上                                     |



## 1.5 None

`None`内置数据类型,  全局通用, 不能进行强制类型转换.

## 1.6 tuple

只有可迭代类型才能进行转换

| 转换类型 | 转换规则                         |
| -------- | -------------------------------- |
| `list`   | `[1, "2", 3]`  --> `(1, "2", 3)` |
| `set`    | `{1, "2", 3}`  --> `(1, "2", 3)` |
| `dict`   | `{1: "1", 2: "2"}`  --> `(1, 2)` |
| `str`    | `'123'`  --> `('1', '2', '3')`   |
|          | 以下数据类型不可转换             |
|          | `None`/`int`/`float`/`bool`      |



## 1.7 list

有序的元素组成的数据结构. 支持索引, 切片, 加, 乘等操作.

强制类型转换参见`tuple`

## 1.8 dict

必须为可迭代类型, 且迭代出来的元素长度为2

| 转换类型 | 转换规则                          |
| -------- | --------------------------------- |
| `tuple`  | `((1, 2), )`  --> `{1: 2}`        |
| `set`    | `{(1, 2)}` --> `{1: 2}`           |
| `list`   | 同上                              |
|          | 以下为不可强制转换类型            |
|          | `None`/`int`/`float`/`bool`/`str` |



## 1.9 set

同`tuple`

# 2. Python类型分类

Python中基本数据类型可以分为两大类

## 2.1 不可变类型

一经创建, 所使用的引用标签不可修改, 主要包含:

* ` int`
* `float`
* `str`
* `bool`
* `None`
* `tuple`

 其中`tuple`比较特殊, 可以对内部数据中可变类型进行修改, 但是tuple的当前引用标签还是未做变更的. 除了`tuple`, 都不可以修改

实例:

```Python
In [1]: a = (1, 3, [1])

In [2]: a[0] = 2
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-2-fa1ba3f7cc8f> in <module>
----> 1 a[0] = 2

TypeError: 'tuple' object does not support item assignment

In [3]: id(a)
Out[3]: 2970078831528

In [4]: a[2].append(3)

In [5]: a
Out[5]: (1, 3, [1, 3])

In [6]: id(a)
Out[6]: 2970078831528

In [7]: c = "abcde"

In [8]: c[2] = 1
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-8-630a5b6f44a9> in <module>
----> 1 c[2] = 1

TypeError: 'str' object does not support item assignment

In [9]: id(c)
Out[9]: 2970080241736

In [10]: c += "dddd"

In [11]: id(c)
Out[11]: 2970080286960

In [12]: c
Out[12]: 'abcdedddd'
```



## 2.2 可变类型

创建后, 随着数据量的增加, 链表关系可能会拓展到连续内存空间上限, 所以引用的内存标签会做变更. 主要包含: 

* `list`
* `set`
* `dict`

```python
In [1]: a = [1, 2, 3]

In [2]: id(a)
Out[2]: 2711772450696

In [3]: a += range(0, 1000)

In [4]: id(a)
Out[4]: 2711772450696
```

# 3. 变量的储存

## 3.1 内存地址

* 变量保存的是内存地址的引用
* 变量实际上就是字典里面的键值对, 键是变量名, 值为变量值
* 系统自带的模块在任何模块中都可以使用

## 3.2 Python变量的维护

* `vars()`

  目标对象必须含有`dict`属性

* `locals()`

  局部变量存储位置

* `globals()`

  全局变量存储位置

## 3.3 变量的内存存储

### 3.3.1 可变类型

- `dict`,`set` 
  dict和set储存方式为哈希表方式储存, 每次创建dict和set对象时, 会向系统申请一个较大的内存空间, 如果在存储时间剩余内存小于总内存的⅓时, 会向系统申请一个更大的内存空间, 并将数据转存到新的内存空间中
- `list` 
  创建空间是:new_allocated += newsize // 3 + 3 if newsize < 9 else 6

### 3.3.2 不可变类型

- `str` 
  python在执行时会对`str`进行缓存, 下次在创建同一个str`直接调用, 缓存池中缓存字符串最大位数位20位

- `int` 
  python在执行时会对`int`进行缓存, 下次在创建同一个`int`直接调用, 缓存整数位数为[-5, +256]

- `bool`, `None` 
  `bool/None`在python解析器开启之时就会创建, 以后调用的都是这个的引用

- `tuple`

  由于`tuple`为不可变类型, 创建后的直属引用标签是没法改变的. 但是存储的内部元素如果为可变类型时, 可以进行修改.  但是它的内存地址是不会改变的.

## 3.4 Python缓存池

CPython在加载时会对一部分数据进行缓存, 在变量赋值时候不会重新创建, 以减少内存的占用, 对于CPython现阶段:

### 3.4.1 整数缓存池

整数的缓存范围 [-5, 256]

 

```
a = 100 # 定义时[-5, +∞)的内存地址是不变的; 加减乘除时在[-5 , 256]中内存地址不会变
b = 100
print(id(a), id(b))
int整型:
        32位系统: 取值范围是[-2**31, 2**31-1]
        64位系统: 取值范围是[-2**63, 2**63-1]
```

### 3.4.2 字符串缓存池

字符串缓存的最大长度 length=20

 

```
a = "hello" # 定义时内存地址一样; 字符拼接时20位以内内存地址不一样
b = "hello"
print(id(a), id(b))
```

### 3.4.3 浮点型

定义时[0, +∞)的内存地址是不变的, 通过算法的出来的内存地址不同

### 3.4.4 元组

定义时内存地址不同; 通过赋值,copy出来的内存地址不会变

### 3.4.5 list, dict, set

列表/字典/集合: 除了引用会出现地址相同, 其他不会出现内存地址相同的情况