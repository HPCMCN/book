# 1. 作用

使各个网络相互连接

# 2. 网络通讯

## 2.1 子网掩码(subnet mask)

### 2.1.1 子网掩码

 转化为二进制后, IP中的1代表网络部分(控制网段), 0表示主机地址.  
必须连续的1和连续的0, 不能出现交. 例:

```python
255.255.240.0  --> 11111111.11111111.11110000.0000
```

所以掩码只能取`0, 128, 192, 224, 240, 248, 252, 254, 255` 

```python
00000000 -> 0
10000000 -> 128
11000000 -> 192
11100000 -> 224
11110000 -> 240
11111000 -> 248
11111100 -> 252
11111110 -> 254
11111111 -> 255
```

### 2.1.2  掩码使用

 子网掩码是和ip同时使用:
 
|十进制|二进制|
|---|---|
|255.255.240.0 | <font color=blue>11111111 . 11111111 . 1111</font><font color=red>0000 . 00000000</font>|
|192.168.0.1      |<font color=blue>11000000 . 10101000 . 0000</font><font color=red>0000 . 00000001</font>|

其中蓝色的部分为网络地址, 红色部分为主机地址.其中网段中主机地址个数可以有
2 * 12 = 4096个, 网段为:

```python
11000000.10101000.00000000.00000000 ~ 11000000.10101000.00001111.11111111即:
192.168.0.0 ~ 192.168.15.255
```

## 2.2 IP地址

### 2.2.1 IP地址

IP地址中包含两部分: 

* 网络地址

 Network Address, 机器所在的网络。
 
* 主机地址

 Host Address, 机器地址也被称为主机地址。
 
### 2.2.2 特殊的IP地址

由子网掩码确定的IP地址范围中

* 第一个

 此地址是这个网络的地址本身, 不能为某个主机所用

* 最后一个

 广播地址, 用于广播的发送

上个例子中能用的IP个数为2 * 12 - 2 = 4094个

## 2.3 IP分类

RFC(Request For Comments) 定义:

* A类

 网络最高位为0且7位网络号, 可用的A类网络有126个，每个网络能容纳1677214个主机

```python
00000001 00000000 00000000 00000001 - 01111110 11111111 11111111 11111110
1.0.0.1-126.255.255.254
```

* B类

 网络最高位为10且14位网络号, 可用的B类网络有16384个，每个网络能容纳65534主机

```python
10000000 00000001 00000000 00000001 - 10111111 11111111 11111111 11111110
128.1.0.1-191.255.255.254
```

* C类

 网络最高位110且有21位网络号, C类网络可达2097152个，每个网络能容纳254个主机
 
```python
11000000 00000000 00000001 00000001 - 11011111 11111111 11111110 11111110
192.0.1.1-223.255.255.254
```

* D类

 网络最高位为1110, 为保留网段, 用于多点广播（Multicast）中
多点广播地址用来一次寻址一组计算机 s 地址范围224.0.0.1-239.255.255.254

* E类

 网络最高位1111, 保留网段, 仅作实验和开发用
 
* 私有 IP 

```
10.0.0.0 / 255.0.0.0 ： 10.0.0.0 ~ 10.255.255.255。A 类私有地址。
172.16.0.0 / 255.240.0.0 ：172.16.0.0 ~ 172.31.255.255。B 类私有地址。
192.168.0.0 / 255.255.0.0 ：192.168.0.0 ~ 192.168.255.255。C 类私有地址。
即:
10.0.0.0 ~ 10.255.255.255，172.16.0.0 ~ 172.31.255.255 和 192.168.0.0 ~ 192.168.255.255 。
```

* 回环地址

 127．0．0．1~127．255．255．255, 用于回环测试
 
# 3. 网络划分

从10.0.0.0中分出 20 + 200 + 1000个IP地址

## 3.1 CIDR

Classless Inter-Domain Routing, 无类别域间路由, 用二进制中的1的数量, 表示子网掩码

```python
192.168.0.1/24 表示:
192.168.0.1/255.255.255.0
```

* 1000个

|十进制|二进制|数量|
|---|---|---|
|255.255.252.0 | <font color=blue>11111111 . 11111111 . 111111</font><font color=red>00 . 00000000</font>|2^10 = 1024|
|10.0.0.0      |<font color=blue>11000000 . 10101000 . 000000</font><font color=red>00 . 00000000</font>|10.0.0.0 ~ 10.0.3.255|

* 200个

|十进制|二进制|数量|
|---|---|---|
|255.255.255.0| <font color=blue>11111111 . 11111111 . 11111111</font><font color=red> . 00000000</font>|2^8 = 256|
|10.0.4.0      |<font color=blue>11000000 . 10101000 . 00000100</font><font color=red> . 00000000</font>|10.0.4.0 ~ 10.0.4.255|

* 10个

|十进制|二进制|数量|
|---|---|---|
|255.255.255.224 | <font color=blue>11111111 . 11111111 . 11111111 . 111</font><font color=red>00000</font>|2^5 = 32|
|10.0.5.0      |<font color=blue>11000000 . 10101000 . 00000101 . 000</font><font color=red>00000</font>|10.0.5.0 ~ 10.0.5.32|


## 3.2 正向划分
* 10个

|十进制|二进制|数量|
|---|---|---|
|255.255.255.224 | <font color=blue>11111111 . 11111111 . 11111111 . 111</font><font color=red>00000</font>|2^5 = 32|
|10.0.0.0      |<font color=blue>11000000 . 10101000 . 00000000 . 000</font><font color=red>00000</font>|10.0.0.0 ~ 10.0.0.32|

* 200个

 **正确的划分**
 
|十进制|二进制|数量|备注|
|---|---|---|---|
|255.255.255.224 | <font color=blue>11111111 . 11111111 . 11111111</font><font color=red> . 00000000</font>|2^8 = 256||
|10.0.1.0      |<font color=blue>11000000 . 10101000 . 00000001</font><font color=red> . 00000000</font>|10.0.1.0 ~ 10.0.1.255|<font color=green>正确</font>|

错误的划分

|十进制|二进制|数量|备注|
|---|---|---|---|
|255.255.255.128| <font color=blue>11111111 . 11111111 . 11111111 . 1</font><font color=red>0000000</font>|2^8 = 256||
|10.0.1.33      |<font color=blue>11000000 . 10101000 . 00000001 . 0</font><font color=red>0100001</font>|10.0.1.33 ~ 10.0.0.255|<font color=red>错误</font>|

理想情况下是: 10.0.1.33 ~ 10.0.0.255, 事实上IP的主机地址置零时为: 

```python
10.0.1.33  --> 11000000.10101000.00000001.00100001
主机地址置0: 11000000.10101000.00000001.00000000 ---> 10.0.0.0
主机地址置1: 11000000.10101000.00000001.01111111 ---> 10.0.0.127
所以真正的范围应该为: 10.0.0.0 ~ 10.0.0.127 存在网络地址交叉, 不合法
```

## 3.3 神奇数字

列出192.168.0.1/21的IP范围

|序号|步骤|结果|
|---|---|---|
|1|神奇数字 = 256 - 有效的子网掩码十进制|255.255.<font color=red>248</font>.0  --> 248 ==> 256 - 248 = 8|
|2|列出神奇数字倍数|0, 8, 16, 24, 32, 40, 48, 56, 64, 72, 80, 88, 96, 104, 112, 120, 128, 136, 144, 152, 160, 168, 176, 184, 192, 200, 208, 216, 224, 232, 240, 248, 256|
|3|第一个IP(小于等于有效的IP十进制)|192.168.<font color=red>0</font>.1  --> 0  ==> 192.168.0.0|
|4|最后一个IP(下一个倍数 - 1)|8 - 1 = 7  --> 192.168.7.255|
|5|IP范围|192.168.0.0 ~ 192.168.7.255 个数为: 2^11=2048|





