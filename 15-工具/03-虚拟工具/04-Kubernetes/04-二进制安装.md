# 1. Master节点

## 1.1 etcd

* etcd

  下载地址: https://github.com/coreos/etcd/releases

  将二进制文件复制到`/usr/bin`中, 然后设置配置服务如下

  ```shell
  # vi /usr/lib/systemd/system/etcd.service
  [Unit]
  Description=Etcd Server
  After=network.target
  
  [Service]
  Type=simple
  WorkingDirectory=/var/lib/etcd/
  EnvironmentFile=/etc/etcd/etcd.conf
  ExecStart=/usr/bin/etcd
  
  [Install]
  WantedBy=multi-user.target
  ```

* 加入开机自启

  ```shell
  systemctl daemon-reload
  systemctl enable etcd.service
  systemctl start etcd.service
  # 查看是否启动成功
  etcdctl endpoint health
  ```

## 1.2 kube-apiserver

* 下载安装

  同样将它复制到/usr/bin目录下, 修改配置参数

  ```shell
  # vi /usr/lib/systemd/system/kube-apiserver.service
  [Unit]
  Description=Kubernetes Api Server
  After=etcd.service
  Wants=etcd.service
  
  [Service]
  Type=notify
  EnvironmentFile=/etc/kubernets/apiserver
  ExecStart=/usr/bin/kube-apiserver $KUBE_API_ARGS
  restart=on-failure
  LimitNOFILE=65536
  
  [Install]
  WantedBy=multi-user.target
  ```

* 配置

  ```shell
  # /etc/kubernetes/apiserver
  KUBE_API_ARGS="--etcd-servers=http://127.0.0.1:2379 --insecure-bind-address=0.0.0.0 --insecure-port=8080 --service-cluster-ip-range=169.169.0.0/16 --service-node-port-range=1-65535 --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota --logtostderr=false --log-dir=/var/log/kubernetes --v=0"
  ```

## 1.3 kube-controller-manager

* 安装配置

  ```shell
  # vi /usr/lib/systemd/system/kube-controller-manager.service
  [Unit]
  Description=Kubernetes Controller Manager
  After=kube-apiserver.service
  Requires=kube-apiserver.service
  
  [Service]
  EnvironmentFile=/etc/kubernets/controller-manager
  ExecStart=/usr/bin/kube-controller-manager $KUBE_CONTROLLER_MANAGER_ARGS
  restart=on-failure
  LimitNOFILE=65536
  
  [Install]
  WantedBy=multi-user.target
  ```

* 配置

  ```yaml
  # /etc/kubernetes/controller-manager
  KUBE_CONTROLLER_MANAGER_ARGS="--kubeconfig=/etc/kubernetes/kubeconfig --logtostderr=false --log-dir=/var/log/kubernetes --v=0"
  
  # /etc/kubernetes/kubeconfig
  apiVersion: v1
  kind: Config
  users:
  - name: client
    user:
  clusters:
  - name: default
    cluster:
      server: http://192.168.18.3:8080
  contexts:
  - context:
      cluster: default
      user: client
    name: default
  current-context: default
  ```

## 1.4 kube-scheduler

* 安装配置

  ```shell
  # vi /usr/lib/systemd/system/kube-scheduler.service
  [Unit]
  Description=Kubernetes Scheduler
  After=kube-apiserver.service
  Requires=kube-apiserver.service
  
  [Service]
  EnvironmentFile=/etc/kubernets/scheduler
  ExecStart=/usr/bin/kube-scheduler $KUBE_SCHEDULER_ARGS
  restart=on-failure
  LimitNOFILE=65536
  
  [Install]
  WantedBy=multi-user.target
  ```

* 配置

  ```shell
  # /etc/kubernetes/scheduler
  KUBE_SCHEDULER_ARGS="--kubeconfig=/etc/kubernetes/kubeconfig --logtostderr=false --log-dir=/var/log/kubernetes --v=0"
  ```

## 1.5 启动全部服务

```shell
systemctl daemon-reload
systemctl enable kube-apiserver.service
systemctl start kube-apiserver.service
systemctl enable kube-controller-manager.service
systemctl start kube-controller-manager.service
systemctl enable kube-scheduler.service
systemctl start kube-scheduler.service
#systemctl status xx, 验证全部服务正常running即可
```

# 2. Node节点

## 2.1 kubelet

* 安装配置

  ```shell
  # vi /usr/lib/systemd/system/kubelet.service
  [Unit]
  Description=Kubernetes kubelet Server
  After=docker.service
  Requires=docker.service
  
  [Service]
  WorkingDirectory=/var/lib/kubelet
  EnvironmentFile=/etc/kubernets/kubelet
  ExecStart=/usr/bin/kubelet $KUBELET_ARGS
  restart=on-failure
  
  [Install]
  WantedBy=multi-user.target
  ```

* 配置

  ```shell
  # /etc/kubernetes/kubelet
  KUBELET_ARGS="--kubeconfig=/etc/kubernetes/kubeconfig --hostname-override=192.168.18.3 --logtostderr=false --log-dir=/var/log/kubernetes --v=0"
  ```

## 2.2 kube-proxy

* 安装配置

  ```shell
  # vi /usr/lib/systemd/system/kube-proxy.service
  [Unit]
  Description=Kubernetes Proxy Server
  After=network.target
  Requires=network.service
  
  [Service]
  WorkingDirectory=/var/lib/proxy
  EnvironmentFile=/etc/kubernets/kubelet
  ExecStart=/usr/bin/kube-proxy $KUBE_PROXY_ARGS
  restart=on-failure
  LimitNOFILE=65536
  
  [Install]
  WantedBy=multi-user.target
  ```

* 配置

  ```shell
  # /etc/kubernetes/proxy
  KUBE_PROXY_ARGS="--kubeconfig=/etc/kubernetes/kubeconfig --logtostderr=false --log-dir=/var/log/kubernetes --v=2"
  ```

## 2.3 启动全部服务

```shell
systemctl daemon-reload
systemctl enable kubelet.service
systemctl start kubelet.service
systemctl enable kube-proxy.service
systemctl start kube-proxy.service
```

